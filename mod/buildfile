# file      : mod/buildfile
# copyright : Copyright (c) 2014-2017 Code Synthesis Ltd
# license   : MIT; see accompanying LICENSE file

define mod: libs
mod{*}: bin.lib.prefix = mod_
mod{*}: install = libexec/

# While we don't need to link to APR, we need to find its header location.
#
import libs  = libapr1%lib{apr-1}
import libs += libstudxml%lib{studxml}
import libs += libodb%lib{odb}
import libs += libodb-pgsql%lib{odb-pgsql}
import libs += libbutl%lib{butl}
import libs += libbpkg%lib{bpkg}
import libs += libbbot%lib{bbot}

include ../libbrep/

mod{brep}:    {hxx ixx txx cxx}{* -options} \
              {hxx ixx     cxx}{   options} \
       ../web/{hxx ixx txx cxx}{* -version} \
       ../web/{hxx            }{   version} \
../web/apache/{hxx ixx txx cxx}{*         } \
../libbrep/lib{brep} $libs

../web/hxx{version}: ../web/in{version} $src_root/file{manifest}
../web/hxx{version}: dist = true

# Don't install any of the module's headers.
#
       {hxx ixx txx}{*}: install = false
../web/{hxx ixx txx}{*}: install = false

# Generated options parser.
#
if $cli.configured
{
  cli.cxx{options}: cli{options}

  # Set option prefix to the empty value to handle all unknown request
  # parameters uniformly with a single catch block.
  #
  cli.options += --std c++11 -I $src_root --include-with-brackets  \
--include-prefix mod --guard-prefix MOD --generate-specifier       \
--cxx-prologue "#include <mod/types-parsers.hxx>"                  \
--cli-namespace brep::cli --generate-file-scanner --suppress-usage \
--generate-modifier --generate-description --option-prefix ""

  # Include generated cli files into the distribution.
  #
  cli.cxx{*}: dist = true
}
